DROP TABLE IF EXISTS USERS, ITEMS, BOOKINGS, COMMENTS;
DROP TYPE IF EXISTS BOOKING_STATUS;

CREATE TABLE IF NOT EXISTS USERS
(
    ID    INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    EMAIL VARCHAR(255),
    NAME  VARCHAR(255)
);

CREATE UNIQUE INDEX EMAIL_INDEX ON USERS (EMAIL);

CREATE TABLE IF NOT EXISTS ITEMS
(
    ID           INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME         VARCHAR(255),
    DESCRIPTION  VARCHAR(255),
    IS_AVAILABLE BOOLEAN,
    OWNER_ID     INTEGER REFERENCES USERS (ID) ON DELETE CASCADE
);

CREATE TYPE BOOKING_STATUS AS ENUM ('WAITING', 'APPROVED', 'REJECTED');

CREATE TABLE IF NOT EXISTS BOOKINGS
(
    ID              INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    START_TIMESTAMP TIMESTAMP,
    END_TIMESTAMP   TIMESTAMP,
    STATUS          BOOKING_STATUS,
    BOOKER_ID       INTEGER REFERENCES USERS (ID),
    ITEM_ID         INTEGER REFERENCES ITEMS (ID)
);

CREATE TABLE IF NOT EXISTS COMMENTS
(
    ID        INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TEXT      VARCHAR(5000),
    AUTHOR_ID INTEGER REFERENCES USERS (ID),
    ITEM_ID   INTEGER REFERENCES ITEMS (ID) ON DELETE CASCADE,
    CREATED   TIMESTAMP DEFAULT NOW()
)
